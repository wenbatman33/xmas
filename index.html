<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Merry Christmas!</title>
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#990000" />
    <link rel="apple-touch-icon" href="icon-192.png" />

    <!-- Open Graph / Social Media Sharing -->
    <meta property="og:title" content="Merry Christmas! ğŸ„" />
    <meta
      property="og:description"
      content="Click to light up the Christmas tree! é»æ“Šé»äº®è–èª•æ¨¹ï¼Œåˆ†äº«ç¯€æ—¥ç¥ç¦ï¼"
    />
    <meta property="og:image" content="og-image.png" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />

    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          // Add timestamp to force update the service worker file itself
          navigator.serviceWorker
            .register("./sw.js?v=" + new Date().getTime())
            .then((reg) => {
              console.log("Service Worker registered properly", reg);
              // Force update check immediately
              reg.update();
            })
            .catch((err) =>
              console.log("Service Worker registration failed", err)
            );
        });
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* * æ ¸å¿ƒé…è‰² 
         * ä¿®æ”¹ç‚ºã€Œç¶ æ¨¹ç´…åº•ã€é…è‰²
         */
      :root {
        --bg-color: #990000; /* è–èª•ç´…èƒŒæ™¯ */

        /* æ¨¹çš„æœ¬é«”é¡è‰² (é—œé–‰ç‹€æ…‹) - æ”¹ç‚ºæ·±ç¶ è‰²ç³» */
        --switch-off-bg: #064e3b; /* æ¥µæ·±ç¶ è‰² (æ¨¹è‘‰é™°å½±) */
        --knob-off: #166534; /* æ·±ç¶ è‰² (æ¨¹è‘‰) */
        --knob-on: #ffffff; /* é–‹å•Ÿæ™‚åœ“éˆ•ä¿æŒç™½è‰² */

        /* æ¨¹å¹¹é¡è‰² - åŠ æ·± */
        --trunk-bg: #281203; /* æ›´æ·±çš„é»‘è¤è‰² */
        --trunk-knob: #451a03; /* æ·±è¤è‰² */

        /* äº®èµ·æ™‚çš„é¡è‰²è®Šæ•¸ - å¢åŠ å¤šç¨®ç¶ è‰² */
        --active-green-light: #4ade80; /* å«©ç¶ è‰²/äº®ç¶  */
        --active-green-medium: #22c55e; /* æ­£ç¶ è‰² */
        --active-green-dark: #15803d; /* æ·±ç¶ è‰² */

        /* é»ç¶´è‰² (è£é£¾å“) */
        --active-red: #ef4444;
        --active-gold: #fbbf24;
        --active-white: #f8fafc;
      }

      body {
        background-color: var(--bg-color);
        font-family: "Courier New", Courier, monospace;
        overflow: hidden; /* é˜²æ­¢æ²è»¸ */
        /* ç¢ºä¿å…§å®¹å‚ç›´ç½®ä¸­ */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      /* éš±è—åŸç”Ÿ checkbox ä½†ä¿ç•™åŠŸèƒ½ */
      .switch-input {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      /* * é–‹é—œæœ¬é«” (å®¹å™¨)
         */
      .switch {
        position: relative;
        height: 28px;
        border-radius: 999px; /* è† å›Šå½¢ç‹€ */
        background-color: var(--switch-off-bg);
        cursor: pointer;
        transition: background-color 0.3s ease;
        display: inline-block;
        margin: 4px;
        /* åˆå§‹å¯¬åº¦ï¼Œæœƒè¢« JS è¦†è“‹ */
        width: 50px;
        /* é¿å…æ‰‹æ©Ÿä¸Šé»æ“Šå‡ºç¾è—è‰²æ¡†æ¡† */
        -webkit-tap-highlight-color: transparent;
      }

      /* * é–‹é—œè£¡çš„åœ“éˆ• (Knob)
         */
      .knob {
        position: absolute;
        top: 4px;
        left: 4px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: var(--knob-off);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* æ¨¹å¹¹å°ˆç”¨æ¨£å¼ (Disabled Switch) */
      .switch.trunk {
        background-color: var(--trunk-bg) !important;
        cursor: default;
        animation: none !important; /* å¼·åˆ¶ç§»é™¤å‹•ç•« */
        box-shadow: none;
      }
      .switch.trunk .knob {
        background-color: var(--trunk-knob) !important;
        transform: translateX(0) !important; /* å¼·åˆ¶ä¿æŒåœ¨å·¦å´ */
        animation: none !important;
      }

      /* * å‹•ç•«å®šç¾© - ç§»é™¤ Keyframesï¼Œæ”¹ç”¨ Transition + Checked ç‹€æ…‹
         */

      /* æ‡‰ç”¨ Checkbox ç‹€æ…‹çš„æ¨£å¼ */

      /* 1. Switch èƒŒæ™¯è‰²è®ŠåŒ– (ç•¶å…§éƒ¨ checkbox è¢«å‹¾é¸æ™‚) */
      /* ä½¿ç”¨ :has é¸å–å™¨ (ç¾ä»£ç€è¦½å™¨æ”¯æ´) */
      .switch:has(.switch-input:checked) {
        background-color: var(--target-color);
      }

      /* 2. Knob ç§»å‹•èˆ‡è®Šè‰² (ç•¶å‰ç½® checkbox è¢«å‹¾é¸æ™‚) */
      .switch-input:checked + .knob {
        background-color: var(--knob-on);
      }

      /* ä¾æ“šä¸åŒå¯¬åº¦è¨­å®šä½ç§»é‡ */
      .switch.w-12 .switch-input:checked + .knob {
        transform: translateX(20px);
      }
      .switch.w-16 .switch-input:checked + .knob {
        transform: translateX(36px);
      }
      .switch.w-20 .switch-input:checked + .knob {
        transform: translateX(52px);
      }
      .switch.w-24 .switch-input:checked + .knob {
        transform: translateX(68px);
      }

      /* ç§»é™¤åŸæœ¬çš„ Keyframes */

      /* * Logo æ¨£å¼ 
         */
      .logo-text {
        color: #fff;
        letter-spacing: 4px;
        font-weight: 700;
        opacity: 0.9;
        transition: all 0.3s;
      }
      .logo-accent {
        color: var(--active-gold); /* é‡‘è‰² */
      }

      /* YouTube å°è¦–çª—æ¨£å¼ */
      .video-container {
        position: fixed;
        bottom: -900px;
        right: 20px;
        width: 240px;
        height: 135px; /* 16:9 æ¯”ä¾‹ */
        z-index: 100;
        border: 4px solid var(--active-gold);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        background-color: #000;
        opacity: 1;
        transition: transform 0.3s ease;
      }
      .video-container:hover {
        transform: scale(1.05);
      }
      .video-label {
        position: absolute;
        top: -25px;
        right: 0;
        color: var(--active-gold);
        font-size: 12px;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }

      /* æ˜Ÿæ˜Ÿæ¨£å¼ */
      .star-container {
        margin-bottom: 4px; /* èˆ‡æ¨¹é ‚ä¿æŒä¸€é»è·é›¢ */
        display: flex;
        justify-content: center;
        align-items: center;
        animation: starPulse 3s infinite ease-in-out;
        z-index: 10;
      }

      .star-svg {
        width: 60px;
        height: 60px;
        fill: var(--active-gold);
        filter: drop-shadow(0 0 8px var(--active-gold));
      }

      @keyframes starPulse {
        0%,
        100% {
          transform: scale(1);
          filter: drop-shadow(0 0 8px var(--active-gold));
        }
        50% {
          transform: scale(1.15);
          filter: drop-shadow(0 0 20px #fbbf24);
        }
      }

      /* -------------------------------------
           æ‰‹æ©Ÿç‰ˆå„ªåŒ– (Mobile Optimization)
           ------------------------------------- */
      @media (max-width: 768px) {
        /* 1. ç¸®å°æ•´æ£µæ¨¹ */
        #tree-container {
          transform: scale(0.65); /* ç¸®å°è‡³ 65% */
          margin-bottom: -2rem; /* èª¿æ•´å› ç‚ºç¸®å°ç”¢ç”Ÿçš„ç©ºç™½ */
        }

        /* æ‰‹æ©Ÿç‰ˆæ˜Ÿæ˜Ÿç¨å¾®èª¿æ•´ */
        .star-svg {
          width: 50px;
          height: 50px;
        }

        /* 2. ç¸®å°å½±ç‰‡è¦–çª—ï¼Œé¿å…æ“‹ä½å¤ªå¤š */
        .video-container {
          width: 160px;
          height: 90px;
          bottom: -900px;
          right: 15px;
          opacity: 1;
          border-width: 2px;
        }
        .video-label {
          font-size: 10px;
          top: -18px;
        }

        /* 3. èª¿æ•´æ–‡å­—å¤§å° */
        .logo-text {
          font-size: 1.1rem;
          margin-top: 0px;
        }
      }

      /* é‡å°æ›´å°çš„è¢å¹• (ä¾‹å¦‚ iPhone SE) */
      @media (max-width: 380px) {
        #tree-container {
          transform: scale(0.55); /* ç¸®å¾—æ›´å° */
        }
      }
    </style>
  </head>
  <body>
    <!-- YouTube æ’­æ”¾å™¨å®¹å™¨ (å³ä¸‹è§’) -->
    <div class="video-container">
      <!-- æ¨™ç±¤èªªæ˜ -->
      <div class="video-label">BGM: Christmas Vibes ğŸµ</div>
      <div id="youtube-player"></div>
    </div>

    <!-- ä¸»è¦å®¹å™¨ -->
    <div id="tree-container" class="flex flex-col items-center gap-2 mb-12">
      <!-- æ˜Ÿæ˜Ÿ (Star) -->
      <div class="star-container">
        <svg
          class="star-svg"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
          />
        </svg>
      </div>
      <!-- Javascript æœƒåœ¨é€™è£¡ç”Ÿæˆé–‹é—œ -->
    </div>

    <!-- åº•éƒ¨æ–‡å­— -->
    <div class="logo-text text-xl text-center">
      <p><span class="logo-accent">Merry</span> Christmas,</p>
      <p>my <span class="bold">dear friend!</span></p>
    </div>

    <script>
      const container = document.getElementById("tree-container");

      // å®šç¾©æ¯ä¸€å±¤çš„é–‹é—œæ•¸é‡èˆ‡é…ç½®
      const rowsConfig = [
        // æ¨¹è‘‰éƒ¨åˆ†
        { count: 1, widths: ["w-12"] },
        { count: 2, widths: ["w-12", "w-12"] },
        { count: 3, widths: ["w-16", "w-12", "w-16"] },
        { count: 4, widths: ["w-12", "w-16", "w-16", "w-12"] },
        { count: 5, widths: ["w-12", "w-12", "w-16", "w-12", "w-12"] },
        { count: 6, widths: ["w-16", "w-12", "w-12", "w-12", "w-12", "w-16"] },
        {
          count: 7,
          widths: ["w-12", "w-16", "w-12", "w-16", "w-12", "w-16", "w-12"],
        },
        {
          count: 8,
          widths: [
            "w-16",
            "w-12",
            "w-16",
            "w-12",
            "w-16",
            "w-12",
            "w-16",
            "w-12",
          ],
        },

        // æ¨¹å¹¹éƒ¨åˆ† (ä½¿ç”¨ type: 'trunk' æ¨™è¨˜)
        // ä¿®æ”¹ç‚ºå–®ä¸€åˆä½µçš„å¯¬æ¨¹å¹¹ (w-24)
        { count: 1, widths: ["w-24"], type: "trunk" },
        { count: 1, widths: ["w-24"], type: "trunk" },
      ];

      // è–èª•é…è‰²
      const colors = [
        "var(--active-green-light)",
        "var(--active-green-medium)",
        "var(--active-green-dark)",
        "var(--active-green-medium)",
        "var(--active-green-light)",
        "var(--active-gold)",
        "var(--active-white)",
        "var(--active-red)",
      ];

      rowsConfig.forEach((row, rowIndex) => {
        const rowDiv = document.createElement("div");
        rowDiv.className = "flex justify-center items-center";

        for (let i = 0; i < row.count; i++) {
          // æ”¹ç”¨ Label ä»¥æ”¯æ´ checkbox
          const switchEl = document.createElement("label");
          const widthClass =
            row.widths[i] || (Math.random() > 0.5 ? "w-12" : "w-16");

          // åˆ¤æ–·æ˜¯å¦ç‚ºæ¨¹å¹¹
          const isTrunk = row.type === "trunk";

          if (isTrunk) {
            // æ¨¹å¹¹ï¼šä¸åŠ å‹•ç•« classï¼ŒåŠ å…¥ trunk class
            switchEl.className = `switch ${widthClass} trunk`;
          } else {
            // æ¨¹è‘‰ï¼šåŠ å…¥éš¨æ©Ÿé¡è‰²
            const randomColor =
              colors[Math.floor(Math.random() * colors.length)];
            // ç§»é™¤ CSS å‹•ç•«é¡åˆ¥
            switchEl.className = `switch ${widthClass}`;
            switchEl.style.setProperty("--target-color", randomColor);

            // éš¨æ©Ÿåˆå§‹ç‹€æ…‹ï¼šæœ‰æ©Ÿæœƒä¸€é–‹å§‹å°±æ˜¯äº®çš„
            if (Math.random() > 0.5) {
              // æœƒåœ¨ç¨å¾Œè¢« Loop è¦†è“‹ï¼Œä½†çµ¦å€‹åˆå€¼
            }
          }

          // æ–°å¢éš±è—çš„ Checkbox
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "switch-input";
          switchEl.appendChild(checkbox);

          // Knob æ”¹ç‚º span
          const knob = document.createElement("span");

          if (isTrunk) {
            // æ¨¹å¹¹æŒ‰éˆ•ï¼šç„¡å‹•ç•«
            knob.className = "knob";
            // æ¨¹å¹¹æ°¸é ä¸å‹¾é¸
          } else {
            // æ¨¹è‘‰æŒ‰éˆ•
            knob.className = "knob"; // ç§»é™¤ knob-anim

            // å•Ÿå‹•éš¨æ©Ÿé–ƒçˆé‚è¼¯ (Real Checkbox Logic)
            startBlinking(checkbox);
          }

          switchEl.appendChild(knob);
          rowDiv.appendChild(switchEl);
        }
        container.appendChild(rowDiv);
      });

      // è®“æ¯å€‹ç‡ˆæ³¡æœ‰ç¨ç«‹çš„é–ƒçˆé »ç‡èˆ‡æ™‚æ©Ÿ
      function startBlinking(checkbox) {
        // éš¨æ©Ÿæ±ºå®šå¤šä¹…åˆ‡æ›ä¸€æ¬¡ (ä¾‹å¦‚ 2ç§’ ~ 6ç§’ ä¹‹é–“)
        // ç‚ºäº†è®“è¦–è¦ºæ¯”è¼ƒåƒåŸæœ¬çš„ Animation Loopï¼Œæˆ‘å€‘å¯ä»¥è¨­å®šä¸€å€‹é€±æœŸ
        // åŸæœ¬å‹•ç•«æ˜¯ 4sï¼Œæˆ‘å€‘ç”¨éš¨æ©Ÿå€é–“ä¾†æ¨¡æ“¬ä¸è¦å‰‡é–ƒçˆ

        const toggle = () => {
          checkbox.checked = !checkbox.checked;

          // ä¸‹ä¸€æ¬¡åˆ‡æ›çš„æ™‚é–“ (éš¨æ©Ÿ) - è®“å®ƒæœ‰é»éš¨æ©Ÿæ„Ÿï¼Œåƒå‘¼å¸ç‡ˆæˆ–äº‚æ•¸é–ƒçˆ
          // äº®çš„çŸ­ä¸€é»ï¼Œæš—çš„é•·ä¸€é»ï¼Ÿæˆ–è€…å¹³å‡ï¼Ÿ
          // æ¨¡æ“¬åŸæœ¬å‹•ç•«ï¼šäº®çš„æ™‚é–“ç´„ä½” 40% (20%~65%)

          let nextDelay;
          if (checkbox.checked) {
            // å¦‚æœç¾åœ¨æ˜¯äº®çš„ï¼Œäº®å¤šä¹…å¾Œç†„æ»…ï¼Ÿ (åŸæœ¬å‹•ç•«ç´„ç¶­æŒ 1.5s ~ 2s)
            nextDelay = 1000 + Math.random() * 1500;
          } else {
            // å¦‚æœç¾åœ¨æ˜¯æš—çš„ï¼Œæš—å¤šä¹…å¾Œäº®èµ·ï¼Ÿ
            nextDelay = 1000 + Math.random() * 2000;
          }

          setTimeout(toggle, nextDelay);
        };

        // åˆå§‹éš¨æ©Ÿå»¶é²å•Ÿå‹•
        const initialDelay = Math.random() * 3000;
        setTimeout(() => {
          toggle();
        }, initialDelay);
      }

      // --- YouTube Player API è¨­å®š ---
      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;

      // æ’­æ”¾æ¸…å–® - å·²æ›´æ–°
      const VIDEO_IDS = [
        "hdiZGSg5RMU",
        "6oD1uYkbc9Y",
        "jgPByUmJ_n0",
        "uEoGR24CirQ",
        "zsFNoriSxHU",
        "7zuiHgFjIH0",
      ];

      let currentVideoIndex = 0;

      window.onYouTubeIframeAPIReady = function () {
        loadPlayer(VIDEO_IDS[currentVideoIndex]);
      };

      function loadPlayer(videoId) {
        player = new YT.Player("youtube-player", {
          height: "100%",
          width: "100%",
          videoId: videoId,
          playerVars: {
            autoplay: 1,
            controls: 1,
            loop: 1,
            playlist: videoId,
            playsinline: 1,
            origin: window.location.origin,
            modestbranding: 1,
          },
          events: {
            onReady: onPlayerReady,
            onError: onPlayerError,
          },
        });
      }

      function onPlayerReady(event) {
        event.target.unMute();
        event.target.playVideo();
      }

      function onPlayerError(event) {
        console.log("Video Error, trying next one...");
        currentVideoIndex++;
        if (currentVideoIndex < VIDEO_IDS.length) {
          player.destroy();
          loadPlayer(VIDEO_IDS[currentVideoIndex]);
        }
      }

      document.body.addEventListener("click", (e) => {
        // é»æ“Šé é¢æ™‚ï¼Œå¯ä»¥éš¨æ©Ÿé‡ç½®ä¸€æ¬¡æ‰€æœ‰ç‡ˆæ³¡ç‹€æ…‹ (Optional Interaction)
        /*
        const inputs = document.querySelectorAll(".switch-input");
        inputs.forEach(input => {
             // éš¨æ©Ÿåˆ‡æ›
             if(Math.random() > 0.5) input.checked = !input.checked;
        });
        */

        // ç¢ºä¿æ’­æ”¾
        if (player && player.getPlayerState && player.getPlayerState() !== 1) {
          player.unMute();
          player.playVideo();
        }
      });
    </script>
  </body>
</html>
